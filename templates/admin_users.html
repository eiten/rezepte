{# Template: admin_users.html
    Purpose: Admin user management (edit user fields, set admin/active, add new users).
    Notes:
    - Uses per-row forms posting to `update_user`; add-row posts to `add_user`.
#}
{% extends "base.html" %}
{% block title %}{{ _("Admin - Benutzerverwaltung") }}{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto pb-12">
    <div class="flex items-center justify-between mb-6">
        <h1 class="text-2xl font-bold text-slate-800">{{ _("Benutzer verwalten") }}</h1>
    </div>

    <div class="bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden">
        <table class="w-full border-collapse">
            <thead class="bg-slate-50 border-b border-slate-200">
                <tr>
                    <th class="px-4 py-3 text-left text-[10px] font-bold text-slate-400 uppercase tracking-widest w-32">{{ _("Benutzername") }}</th>
                    <th class="px-4 py-3 text-left text-[10px] font-bold text-slate-400 uppercase tracking-widest w-32">{{ _("Anzeigename / E-Mail") }}</th>
                    <th class="px-4 py-3 text-left text-[10px] font-bold text-slate-400 uppercase tracking-widest w-56">{{ _("Neues Passwort") }}</th>
                    <th class="px-4 py-3 text-center text-[10px] font-bold text-slate-400 uppercase tracking-widest w-20">{{ _("Admin") }}</th>
                    <th class="px-4 py-3 text-center text-[10px] font-bold text-slate-400 uppercase tracking-widest w-20">{{ _("Aktiv") }}</th>
                    <th class="px-4 py-3 text-right text-[10px] font-bold text-slate-400 uppercase tracking-widest w-16">{{ _("Aktion") }}</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-slate-100">
                {% for u in users %}
                <tr class="hover:bg-slate-50/50 transition-colors">
                    <form action="{{ url_for('update_user') }}" method="post">
                        <input type="hidden" name="user_id" value="{{ u.id }}">
                           <td class="px-4 py-2 w-32">
                            <input type="text" name="username" value="{{ u.username }}" required
                                   class="w-full rounded-md border-slate-200 py-1 px-2 text-sm font-medium focus:border-accent focus:ring-accent">
                        </td>
                           <td class="px-4 py-2 w-32">
                            <input type="text" name="display_name" value="{{ u.display_name }}" placeholder="{{ _("Anzeigename") }}"
                                   class="w-full rounded-md border-slate-200 py-1 px-2 text-sm mb-1 focus:border-accent focus:ring-accent">
                            <input type="email" name="email" value="{{ u.email or '' }}" placeholder="{{ _("E-Mail") }}"
                                   class="w-full rounded-md border-slate-200 py-0.5 px-2 text-xs text-slate-500 focus:border-accent focus:ring-accent">
                        </td>
                           <td class="px-4 py-2 w-56">
                            <input type="password" name="new_password" placeholder="{{ _("Leer lassen = keine Änderung") }}"
                                   class="w-full rounded-md border-slate-200 py-1 px-2 text-xs focus:border-accent focus:ring-accent">
                        </td>
                        <td class="px-4 py-2 text-center">
                            <input type="checkbox" name="is_admin" class="w-4 h-4 text-accent rounded focus:ring-accent" 
                                   {% if u.role == 'admin' %}checked{% endif %}>
                        </td>
                        <td class="px-4 py-2 text-center">
                            <input type="checkbox" name="is_active" class="w-4 h-4 text-green-500 rounded focus:ring-green-500" 
                                   {% if u.is_active %}checked{% endif %}>
                        </td>
                        <td class="px-4 py-2 text-right">
                            <button type="submit" class="p-2 text-slate-400 hover:text-accent transition-colors" title="{{ _("Speichern") }}">
                                <span class="ph-btn-icon text-xl">&#xE248;</span>
                            </button>
                        </td>
                    </form>
                </tr>
                {% endfor %}

                <tr class="bg-accent-soft/5">
                    <form action="{{ url_for('add_user') }}" method="post">
                        <td class="px-4 py-3 w-32">
                            <input type="text" name="username" placeholder="{{ _("Neuer Benutzer...") }}" required
                                   class="w-full rounded-md border-accent/20 py-1 px-2 text-sm focus:border-accent focus:ring-accent bg-white">
                        </td>
                        <td class="px-4 py-3 w-32">
                            <input type="text" name="display_name" placeholder="{{ _("Vollständiger Name") }}" required
                                   class="w-full rounded-md border-accent/20 py-1 px-2 text-sm focus:border-accent focus:ring-accent bg-white">
                        </td>
                        <td class="px-4 py-3 w-56">
                            <input type="password" name="password" placeholder="{{ _("Passwort vergeben") }}" required
                                   class="w-full rounded-md border-accent/20 py-1 px-2 text-sm focus:border-accent focus:ring-accent bg-white">
                        </td>
                        <td class="px-4 py-3 text-center">
                            <input type="checkbox" name="is_admin" class="w-4 h-4 text-accent rounded">
                        </td>
                        <td class="px-4 py-3 text-center">
                            <span class="text-[10px] font-bold text-green-600">{{ _("AUTO-AKTIV") }}</span>
                        </td>
                        <td class="px-4 py-3 text-right">
                            <button type="submit" class="p-2 text-accent hover:text-accent-dark transition-colors" title="{{ _("Hinzufügen") }}">
                                <span class="ph-btn-icon text-xl">&#xE3D6;</span>
                            </button>
                        </td>
                    </form>
                </tr>
            </tbody>
        </table>
    </div>
</div>
{% endblock %}